<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Einkaufsliste Kroatien</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icons/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <style>
    :root {
      --bg: #f7fafc;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #0ea5e9;
      --border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; background: var(--bg); color: var(--text); }
    header {
      position: sticky; top: 0; z-index: 50; background: var(--card); border-bottom: 1px solid var(--border);
      padding: 12px 16px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
    }
    header h1 { font-size: 18px; margin: 0; }
    .controls { display: flex; gap: 8px; flex: 1; align-items: center; flex-wrap: wrap; }
    input[type='search'] { flex: 1; min-width: 180px; padding: 10px 12px; font-size: 16px; border: 1px solid var(--border); border-radius: 12px; background: #fff; }
    button, .chip { border: 1px solid var(--border); background: var(--card); padding: 8px 10px; border-radius: 12px; font-size: 14px; }
    button.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
    main { padding: 12px; max-width: 900px; margin: 0 auto; }
    section { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 10px; margin-bottom: 12px; }
    section h2 { margin: 4px 8px 8px; font-size: 16px; color: var(--muted); display:flex; align-items:center; justify-content: space-between; }
    ul { list-style: none; padding: 0; margin: 0; }
    li.item { display: flex; align-items: center; gap: 10px; padding: 8px 8px; border-radius: 10px; }
    li.item:hover { background: #f3f4f6; }
    input[type='checkbox'] { width: 22px; height: 22px; }
    label { flex: 1; font-size: 16px; }
    .done label { text-decoration: line-through; color: var(--muted); }
    .hidden { display: none !important; }
    .counts { font-size: 12px; color: var(--muted); }
    .footer { text-align:center; color: var(--muted); font-size: 12px; padding: 20px 0 40px; }
    .small { font-size: 12px; color: var(--muted); }
    .cat-actions { display:flex; gap:8px; align-items:center; }
    .toggle { cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ›’ Einkaufsliste</h1>
    <div class="controls">
      <input id="search" type="search" placeholder="Suchen/filtern â€¦" aria-label="Suche">
      <button id="toggleHide" class="chip">Erledigte ausblenden</button>
      <button id="reset" class="chip">Alle zurÃ¼cksetzen</button>
      <button id="export" class="chip">Export</button>
      <span class="counts" id="counts"></span>
    </div>
  </header>
  <main id="app" aria-live="polite"></main>
  <div class="footer">Offline nutzbar â€¢ Auf den Homescreen hinzufÃ¼gen fÃ¼r App-Feeling</div>

  <script>
    // ---- Daten ----
    const DATA = {
      "Obst & GemÃ¼se": [
        "2 Bund Bananen (1 grÃ¼n, fÃ¼r Dian)",
        "10 Ã„pfel (6 fÃ¼r Dian)",
        "2 kleine Wassermelonen",
        "3 x Mango",
        "1 Pack Nectarinen",
        "14 Orangen (Essen & Drinks, Ella & Dian)",
        "5 Gurken (Salat & FrÃ¼hstÃ¼ck)",
        "3 Paprika",
        "3 Avocado",
        "3 kg Tomaten (Ella, Salat, Pizza, Toast)",
        "5 SalatkÃ¶pfe",
        "2 kg Zwiebeln",
        "2 Knoblauchknollen (1 Packung)",
        "1 x Basilikum (Strauch)",
        "5 kg Kartoffeln (Raclette, Beilage, Pellkartoffeln)"
      ],
      "Milchprodukte & KÃ¤se": [
        "12 x Mozzarella (Ella, Salat, Pizza)",
        "3 Pack geriebener PizzakÃ¤se (Pizza)",
        "3 Pack RaclettekÃ¤se oder ScheibenkÃ¤se Gauda",
        "1 x Gorgonzola",
        "2 x BergkÃ¤se",
        "2 x HartkÃ¤se (FrÃ¼hstÃ¼ck/Wurstsalat)",
        "2 Pack Parmesan (gerieben)",
        "1 x Butter",
        "1 x Flasche Sahne",
        "6 x Fruchtjoghurt",
        "1 kg Naturjoghurt (Dian)",
        "4 x 250 g Griechisches Joghurt oder Sauerrahm (Sauce)",
        "1 x Fruchtzwerge (Dian)",
        "6 x 1 L Haltbarmilch (Dian, FrÃ¼hstÃ¼ck)"
      ],
      "Brot & Backwaren": [
        "2 x Schwarzbrot (geschnitten)",
        "4 Pack AufbackbrÃ¶tchen",
        "2 Pack Aufback Koblauchbrot",
        "3 Pack Toastbrot"
      ],
      "Fleisch & Wurst": [
        "10 StÃ¼ck LandjÃ¤ger",
        "5 Paar Wienerle (10 StÃ¼ck)",
        "2 Pack GrillwÃ¼rstchen",
        "4 Pack Grillfleisch (je 4 StÃ¼ck)",
        "4 Pack Cevapcici",
        "2 Pack Geschnetzeltes",
        "5 Pack Speck (FrÃ¼hstÃ¼ck & Tischgrill)",
        "1 Pack SpeckwÃ¼rfel (Spaghetti)",
        "5 Pack geschnittene Salami (FrÃ¼hstÃ¼ck & Tischgrill)",
        "3 Pack Schinken (Toast)",
        "3 Pack ScheibenkÃ¤se (Toast)",
        "1 x Lyoner (Wurstsalat)"
      ],
      "Nudeln, Reis & Teig": [
        "2 kg Spaghetti",
        "1 kg Penne",
        "1 kg Reis (Beilage)",
        "5 x Pizzateig",
        "500 g HartweizengrieÃŸ (Dian)",
        "500 g Haferflocken (Dian)",
        "1 Packung Zwieback ohne Zucker (Dian)"
      ],
      "Konserven & Eingemachtes": [
        "2 GlÃ¤ser Essiggurken",
        "1 groÃŸes Glas schwarze Oliven",
        "1 groÃŸes Glas grÃ¼ne Oliven",
        "1 Glas Kapern (Pizza & Toast)",
        "4 Dosen Thunfisch (Pizza, Elias)",
        "2 Dosen Gulaschsuppe",
        "3 GlÃ¤ser Ajvar (Sauce)",
        "4 groÃŸe GlÃ¤ser gewÃ¼rzte Tomatensauce"
      ],
      "GewÃ¼rze & Basics": [
        "1 x Salz",
        "1 x Pfeffer",
        "1 x Oregano",
        "1 x OlivenÃ¶l",
        "1 x Essig Aceto",
        "1 x WeiÃŸweinessig"
      ],
      "TiefkÃ¼hl": [
        "1 kg Himbeeren (Elias & Ella)",
        "500 g Beerenmix (Dian)",
        "2 Pack Eis am Stiel",
        "1 x TiefkÃ¼hlkrÃ¤uter",
        "2 Pack Kroketten"
      ],
      "Snacks & SÃ¼ÃŸes": [
        "5 x Chips",
        "4 x WÃ¼rmle",
        "4 x Soletti",
        "3 x Kekse",
        "2 x Fertigkuchen (Marmor, Roulade, â€¦)"
      ],
      "Saucen & Sonstiges": [
        "1 x KrÃ¤uterbutter",
        "1 x Senf",
        "1 x Ketchup",
        "1 x Mayo",
        "1 x Holundersirup"
      ],
      "Fertiggerichte": [
        "3 groÃŸe Fertiglasagne"
      ],
      "GetrÃ¤nke & HeiÃŸgetrÃ¤nke": [
        "9 x 6er 2L Bier (108 L)",
        "40 x 0,5 L Alkoholfreies Bier (20 L)",
        "12 x Sanbitter (alkfrei)",
        "4 x 1 L Tonic (2 fÃ¼r Gin)",
        "1 x Gin",
        "1 x Rum",
        "1 x Vodka (fÃ¼r O-Saft/Gingerbeer)",
        "1 x Campari",
        "1 x Aperol",
        "2 x Bitterol",
        "20 x Sekt",
        "6 Flaschen WeiÃŸwein",
        "7 x 1 L Orangensaft (FrÃ¼hstÃ¼ck + Drinks)",
        "4 x 1 L Mangosaft (FrÃ¼hstÃ¼ck + Drinks)",
        "1 x 6er 2L Cola",
        "2 x 6er 2L Sprite (Kinder + Radler)",
        "1 x 6er 2L Mineralwasser",
        "6 x 6er 2L Stilles Wasser",
        "6 x 5L Stilles Wasser",
        "2 x 0,5 kg Kaffee gemahlen"
      ],
      "Haushalt": [
        "1 Pack Klopapier (10 Rollen?)"
      ]
    };

    // ---- State & Persistenz ----
    const STORAGE_KEY = "einkaufsliste-state-v2";
    let state = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); // { [id]: true/false }
    let hideDone = JSON.parse(localStorage.getItem("hide-done") || "false");

    function idFor(text) {
      // stabile ID aus Text
      return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    }

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      localStorage.setItem("hide-done", JSON.stringify(hideDone));
      updateCounts();
    }

    function updateCounts() {
      const all = Array.from(document.querySelectorAll('li.item')).length;
      const done = Array.from(document.querySelectorAll('li.item.done')).length;
      const counts = document.getElementById('counts');
      counts.textContent = `${done}/${all} erledigt`;
    }

    // ---- Rendering ----
    const app = document.getElementById('app');
    function render(filter = "") {
      app.innerHTML = "";
      const q = filter.trim().toLowerCase();

      Object.entries(DATA).forEach(([cat, items]) => {
        const section = document.createElement('section');
        const title = document.createElement('h2');
        const right = document.createElement('div');
        right.className = 'cat-actions';
        const small = document.createElement('span');
        small.className = 'small';
        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'chip toggle';
        toggleBtn.textContent = 'Alle abhaken';
        toggleBtn.addEventListener('click', () => {
          const allChecked = Array.from(section.querySelectorAll('input[type=checkbox]')).every(cb => cb.checked);
          section.querySelectorAll('input[type=checkbox]').forEach(cb => { cb.checked = !allChecked; cb.dispatchEvent(new Event('change')); });
        });
        right.appendChild(toggleBtn);
        title.textContent = cat;
        title.appendChild(right);
        section.appendChild(title);

        const ul = document.createElement('ul');

        items.forEach(text => {
          const id = idFor(`${cat}-${text}`);
          if (!(id in state)) state[id] = false;

          if (q && !text.toLowerCase().includes(q) && !cat.toLowerCase().includes(q)) return;

          const li = document.createElement('li'); li.className = 'item';
          const cb = document.createElement('input'); cb.type = 'checkbox'; cb.id = id; cb.checked = !!state[id];
          const label = document.createElement('label'); label.setAttribute('for', id); label.textContent = text;

          function apply() {
            li.classList.toggle('done', cb.checked);
            if (hideDone) li.classList.toggle('hidden', cb.checked);
          }
          cb.addEventListener('change', () => { state[id] = cb.checked; save(); apply(); });
          apply();

          li.appendChild(cb); li.appendChild(label); ul.appendChild(li);
        });

        const countAll = items.length;
        const countDone = Object.entries(state).filter(([key,val]) => key.startsWith(idFor(cat)) && val).length;
        small.textContent = `${countDone}/${countAll}`;
        title.appendChild(small);

        section.appendChild(ul);
        if (ul.children.length === 0) return; // skip empty after filter
        app.appendChild(section);
      });

      updateCounts();
    }

    // ---- Controls ----
    const search = document.getElementById('search');
    search.addEventListener('input', () => render(search.value));

    const btnHide = document.getElementById('toggleHide');
    function applyHideState() {
      btnHide.textContent = hideDone ? 'Erledigte einblenden' : 'Erledigte ausblenden';
      document.querySelectorAll('li.item').forEach(li => {
        if (li.classList.contains('done')) li.classList.toggle('hidden', hideDone);
      });
    }
    btnHide.addEventListener('click', () => { hideDone = !hideDone; save(); applyHideState(); });

    document.getElementById('reset').addEventListener('click', () => {
      if (!confirm('Wirklich alle HÃ¤kchen entfernen?')) return;
      Object.keys(state).forEach(k => state[k] = false);
      save(); render(search.value);
    });

    // Export/Import als JSON
    document.getElementById('export').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(state, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'einkaufsliste-status.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    // Initial render
    render();

    // ---- Service Worker Registrierung ----
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
</body>
</html>
